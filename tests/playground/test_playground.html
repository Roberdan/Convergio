<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convergio Test Playground</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .header p {
            text-align: center;
            color: #718096;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .panel h2 {
            color: #4a5568;
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #68d391 0%, #48bb78 100%);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .conversation-area {
            height: 400px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8fafc;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            max-width: 80%;
        }
        
        .message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
        }
        
        .message.agent {
            background: white;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }
        
        .message .meta {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .message .content {
            line-height: 1.5;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            display: block;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .agent-list {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }
        
        .agent-item {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .agent-item:hover {
            background: #edf2f7;
        }
        
        .agent-item.selected {
            background: #667eea;
            color: white;
        }
        
        .agent-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
        }
        
        .agent-status.testing {
            background: #ed8936;
        }
        
        .agent-status.error {
            background: #f56565;
        }
        
        .test-results {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .result-item {
            padding: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #48bb78;
            background: #f0fff4;
            border-radius: 4px;
        }
        
        .result-item.error {
            border-left-color: #f56565;
            background: #fed7d7;
        }
        
        .result-item.warning {
            border-left-color: #ed8936;
            background: #ffebc8;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 15px;
        }
        
        .tab-button {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: rgba(255, 255, 255, 0.95);
            color: #4a5568;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>🧪 Convergio Test Playground</h1>
                <p>Interactive testing environment for all 48 agents, multi-agent workflows, and system capabilities</p>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button" :class="{ active: activeTab === 'agents' }" @click="activeTab = 'agents'">
                        🤖 Agent Testing
                    </button>
                    <button class="tab-button" :class="{ active: activeTab === 'workflows' }" @click="activeTab = 'workflows'">
                        🤝 Workflows
                    </button>
                    <button class="tab-button" :class="{ active: activeTab === 'performance' }" @click="activeTab = 'performance'">
                        📊 Performance
                    </button>
                    <button class="tab-button" :class="{ active: activeTab === 'reports' }" @click="activeTab = 'reports'">
                        📈 Reports
                    </button>
                </div>
                
                <!-- Agent Testing Tab -->
                <div class="tab-content" :class="{ active: activeTab === 'agents' }">
                    <div class="main-content">
                        <!-- Agent Selection Panel -->
                        <div class="panel">
                            <h2>🎯 Agent Selection</h2>
                            <div class="form-group">
                                <label>Search Agents:</label>
                                <input type="text" class="form-control" v-model="agentSearch" placeholder="Search by name, role, or category...">
                            </div>
                            <div class="agent-list">
                                <div 
                                    class="agent-item" 
                                    :class="{ selected: selectedAgent?.agent_id === agent.agent_id }"
                                    v-for="agent in filteredAgents" 
                                    :key="agent.agent_id"
                                    @click="selectAgent(agent)"
                                >
                                    <div>
                                        <strong>{{ agent.name }}</strong><br>
                                        <small>{{ agent.role }} ({{ agent.category }})</small>
                                    </div>
                                    <div class="agent-status" :class="getAgentStatus(agent.agent_id)"></div>
                                </div>
                            </div>
                            <div class="form-group" style="margin-top: 15px;">
                                <button class="btn btn-primary" @click="testAllAgents" :disabled="testingInProgress">
                                    <span v-if="testingInProgress" class="loading"></span>
                                    Test All Agents
                                </button>
                                <button class="btn btn-secondary" @click="loadAgents" style="margin-left: 10px;">
                                    🔄 Refresh
                                </button>
                            </div>
                        </div>
                        
                        <!-- Conversation Panel -->
                        <div class="panel">
                            <h2>💬 Agent Conversation</h2>
                            <div v-if="selectedAgent">
                                <div class="form-group">
                                    <label>Selected Agent: <strong>{{ selectedAgent.name }}</strong></label>
                                    <small style="display: block; color: #718096;">{{ selectedAgent.role }} - {{ selectedAgent.category }}</small>
                                </div>
                                <div class="conversation-area">
                                    <div 
                                        class="message" 
                                        :class="msg.type" 
                                        v-for="msg in conversation" 
                                        :key="msg.id"
                                    >
                                        <div class="meta">{{ msg.timestamp }} - {{ msg.agent || 'You' }}</div>
                                        <div class="content">{{ msg.content }}</div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        v-model="messageInput" 
                                        placeholder="Type your message..."
                                        @keyup.enter="sendMessage"
                                        :disabled="sendingMessage"
                                    >
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary" @click="sendMessage" :disabled="sendingMessage || !messageInput.trim()">
                                        <span v-if="sendingMessage" class="loading"></span>
                                        Send Message
                                    </button>
                                    <button class="btn btn-secondary" @click="clearConversation" style="margin-left: 10px;">
                                        Clear
                                    </button>
                                    <button class="btn btn-success" @click="testAgentCapabilities" style="margin-left: 10px;" :disabled="testingAgent">
                                        <span v-if="testingAgent" class="loading"></span>
                                        Test Capabilities
                                    </button>
                                </div>
                            </div>
                            <div v-else class="text-center" style="padding: 50px; color: #718096;">
                                Select an agent to start a conversation
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Workflows Tab -->
                <div class="tab-content" :class="{ active: activeTab === 'workflows' }">
                    <div class="main-content">
                        <!-- Workflow Selection -->
                        <div class="panel">
                            <h2>🤝 Multi-Agent Workflows</h2>
                            <div class="form-group">
                                <label>Select Workflow:</label>
                                <select class="form-control" v-model="selectedWorkflow">
                                    <option value="">Choose a workflow...</option>
                                    <option value="strategic_planning">Strategic Planning (Ali, Amy, Baccio)</option>
                                    <option value="problem_solving">Problem Solving (Ava, Behice, Andrea, Sofia)</option>
                                    <option value="technical_design">Technical Design (Baccio, Dan, Marco, Luca)</option>
                                    <option value="creative_collaboration">Creative Collaboration (Jony, Sara, Sofia, Riccardo)</option>
                                    <option value="crisis_management">Crisis Management (Thor, Luca, Dan, Ali)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Custom Scenario:</label>
                                <textarea class="form-control" rows="3" v-model="customScenario" placeholder="Describe your custom workflow scenario..."></textarea>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" @click="runWorkflow" :disabled="workflowRunning || !selectedWorkflow">
                                    <span v-if="workflowRunning" class="loading"></span>
                                    Run Workflow
                                </button>
                                <button class="btn btn-secondary" @click="stopWorkflow" style="margin-left: 10px;" :disabled="!workflowRunning">
                                    Stop Workflow
                                </button>
                            </div>
                            <div v-if="workflowProgress > 0" class="progress-bar">
                                <div class="progress-fill" :style="{ width: workflowProgress + '%' }"></div>
                            </div>
                        </div>
                        
                        <!-- Workflow Results -->
                        <div class="panel">
                            <h2>📋 Workflow Results</h2>
                            <div v-if="workflowResults.length > 0">
                                <div 
                                    class="result-item" 
                                    :class="result.type" 
                                    v-for="result in workflowResults" 
                                    :key="result.id"
                                >
                                    <strong>{{ result.agent }}</strong> ({{ result.timestamp }})<br>
                                    {{ result.message }}
                                </div>
                            </div>
                            <div v-else class="text-center" style="padding: 50px; color: #718096;">
                                Workflow results will appear here
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Tab -->
                <div class="tab-content" :class="{ active: activeTab === 'performance' }">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-value">{{ performanceStats.totalTests }}</span>
                            <div class="stat-label">Total Tests</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value">{{ performanceStats.successRate }}%</span>
                            <div class="stat-label">Success Rate</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value">{{ performanceStats.avgResponseTime }}ms</span>
                            <div class="stat-label">Avg Response Time</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value">${{ performanceStats.totalCost }}</span>
                            <div class="stat-label">Total Cost</div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Response Time Trends</h3>
                        <canvas id="responseTimeChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Agent Performance Comparison</h3>
                        <canvas id="agentPerformanceChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="panel">
                        <h2>🔧 Performance Testing</h2>
                        <div class="form-group">
                            <label>Load Test Configuration:</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                                <input type="number" class="form-control" v-model="loadTest.concurrent" placeholder="Concurrent Users" min="1" max="20">
                                <input type="number" class="form-control" v-model="loadTest.duration" placeholder="Duration (seconds)" min="5" max="300">
                                <input type="number" class="form-control" v-model="loadTest.requests" placeholder="Total Requests" min="10" max="1000">
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary" @click="runLoadTest" :disabled="loadTestRunning">
                                <span v-if="loadTestRunning" class="loading"></span>
                                Run Load Test
                            </button>
                            <button class="btn btn-danger" @click="runStressTest" style="margin-left: 10px;" :disabled="stressTestRunning">
                                <span v-if="stressTestRunning" class="loading"></span>
                                Stress Test
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Tab -->
                <div class="tab-content" :class="{ active: activeTab === 'reports' }">
                    <div class="panel">
                        <h2>📈 Test Reports</h2>
                        <div class="form-group">
                            <button class="btn btn-primary" @click="generateReport">
                                📊 Generate Full Report
                            </button>
                            <button class="btn btn-secondary" @click="exportResults" style="margin-left: 10px;">
                                💾 Export Results
                            </button>
                            <button class="btn btn-secondary" @click="downloadLogs" style="margin-left: 10px;">
                                📋 Download Logs
                            </button>
                        </div>
                        <div v-if="reportData" class="test-results">
                            <h3>Executive Summary</h3>
                            <p><strong>Test Suite:</strong> {{ reportData.testSuite }}</p>
                            <p><strong>Execution Time:</strong> {{ reportData.executionTime }}</p>
                            <p><strong>Success Rate:</strong> {{ reportData.successRate }}%</p>
                            <p><strong>Issues Found:</strong> {{ reportData.issuesCount }}</p>
                            
                            <h3>Detailed Results</h3>
                            <div 
                                class="result-item" 
                                :class="result.status" 
                                v-for="result in reportData.detailedResults" 
                                :key="result.id"
                            >
                                <strong>{{ result.testName }}</strong><br>
                                {{ result.description }}<br>
                                <small>Duration: {{ result.duration }}ms | Status: {{ result.status }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    activeTab: 'agents',
                    agents: [],
                    selectedAgent: null,
                    agentSearch: '',
                    conversation: [],
                    messageInput: '',
                    sendingMessage: false,
                    testingAgent: false,
                    testingInProgress: false,
                    agentStatuses: {},
                    
                    // Workflow data
                    selectedWorkflow: '',
                    customScenario: '',
                    workflowRunning: false,
                    workflowProgress: 0,
                    workflowResults: [],
                    
                    // Performance data
                    performanceStats: {
                        totalTests: 0,
                        successRate: 0,
                        avgResponseTime: 0,
                        totalCost: 0
                    },
                    loadTest: {
                        concurrent: 5,
                        duration: 30,
                        requests: 100
                    },
                    loadTestRunning: false,
                    stressTestRunning: false,
                    
                    // Reports data
                    reportData: null,
                    
                    // API configuration
                    apiBase: 'http://localhost:9000',
                    sessionId: 'playground_' + Date.now()
                }
            },
            
            computed: {
                filteredAgents() {
                    if (!this.agentSearch) return this.agents;
                    const search = this.agentSearch.toLowerCase();
                    return this.agents.filter(agent => 
                        agent.name.toLowerCase().includes(search) ||
                        agent.role.toLowerCase().includes(search) ||
                        agent.category.toLowerCase().includes(search)
                    );
                }
            },
            
            mounted() {
                this.loadAgents();
                this.initializeCharts();
                this.updatePerformanceStats();
            },
            
            methods: {
                async loadAgents() {
                    try {
                        // Mock agent data for demonstration
                        this.agents = [
                            { agent_id: 'ali', name: 'Ali CEO', role: 'Chief Executive Officer', category: 'strategic' },
                            { agent_id: 'amy', name: 'Amy CFO', role: 'Chief Financial Officer', category: 'financial' },
                            { agent_id: 'baccio', name: 'Baccio', role: 'Tech Architect', category: 'technical' },
                            { agent_id: 'dan', name: 'Dan', role: 'Engineering GM', category: 'technical' },
                            { agent_id: 'sara', name: 'Sara', role: 'UX/UI Designer', category: 'creative' },
                            { agent_id: 'sofia', name: 'Sofia', role: 'Marketing Strategist', category: 'marketing' },
                            { agent_id: 'luca', name: 'Luca', role: 'Security Expert', category: 'security' },
                            { agent_id: 'ava', name: 'Ava', role: 'Analytics Virtuoso', category: 'analytics' },
                            // Add more agents...
                        ];
                        
                        // Initialize agent statuses
                        this.agents.forEach(agent => {
                            this.agentStatuses[agent.agent_id] = 'ready';
                        });
                        
                    } catch (error) {
                        console.error('Failed to load agents:', error);
                        this.addMessage('system', 'Failed to load agents: ' + error.message);
                    }
                },
                
                selectAgent(agent) {
                    this.selectedAgent = agent;
                    this.conversation = [];
                    this.addMessage('system', `Selected ${agent.name} (${agent.role})`);
                },
                
                async sendMessage() {
                    if (!this.messageInput.trim() || !this.selectedAgent) return;
                    
                    const message = this.messageInput.trim();
                    this.messageInput = '';
                    this.sendingMessage = true;
                    
                    // Add user message
                    this.addMessage('user', message);
                    
                    try {
                        const response = await fetch(`${this.apiBase}/api/v1/agents/conversation`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: message,
                                agent: this.selectedAgent.agent_id,
                                session_id: this.sessionId,
                                context: { playground: true }
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.addMessage('agent', data.response || data.content, this.selectedAgent.name);
                            
                            // Update performance stats
                            if (data.cost) {
                                this.performanceStats.totalCost += parseFloat(data.cost);
                            }
                        } else {
                            this.addMessage('system', `Error: ${data.detail || data.error || 'Unknown error'}`);
                        }
                        
                    } catch (error) {
                        console.error('Send message error:', error);
                        this.addMessage('system', `Network error: ${error.message}`);
                    } finally {
                        this.sendingMessage = false;
                    }
                },
                
                async testAgentCapabilities() {
                    if (!this.selectedAgent) return;
                    
                    this.testingAgent = true;
                    this.agentStatuses[this.selectedAgent.agent_id] = 'testing';
                    
                    try {
                        const testMessages = [
                            'Please introduce yourself and your capabilities.',
                            'What are your core strengths?',
                            'How can you help with complex problems?'
                        ];
                        
                        for (const testMessage of testMessages) {
                            this.addMessage('system', `Testing: ${testMessage}`);
                            
                            const response = await fetch(`${this.apiBase}/api/v1/agents/conversation`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    message: testMessage,
                                    agent: this.selectedAgent.agent_id,
                                    session_id: this.sessionId + '_test',
                                    context: { capability_test: true }
                                })
                            });
                            
                            const data = await response.json();
                            
                            if (response.ok) {
                                this.addMessage('agent', data.response || data.content, this.selectedAgent.name);
                                this.agentStatuses[this.selectedAgent.agent_id] = 'ready';
                            } else {
                                this.agentStatuses[this.selectedAgent.agent_id] = 'error';
                                this.addMessage('system', `Test failed: ${data.detail || data.error}`);
                            }
                            
                            // Brief pause between tests
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                        
                    } catch (error) {
                        console.error('Capability test error:', error);
                        this.agentStatuses[this.selectedAgent.agent_id] = 'error';
                        this.addMessage('system', `Capability test failed: ${error.message}`);
                    } finally {
                        this.testingAgent = false;
                    }
                },
                
                async testAllAgents() {
                    this.testingInProgress = true;
                    
                    try {
                        let successCount = 0;
                        const startTime = Date.now();
                        
                        for (const agent of this.agents) {
                            this.agentStatuses[agent.agent_id] = 'testing';
                            
                            try {
                                const response = await fetch(`${this.apiBase}/api/v1/agents/conversation`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        message: 'Health check - please respond briefly.',
                                        agent: agent.agent_id,
                                        session_id: this.sessionId + '_health_' + agent.agent_id,
                                        context: { health_check: true }
                                    })
                                });
                                
                                if (response.ok) {
                                    this.agentStatuses[agent.agent_id] = 'ready';
                                    successCount++;
                                } else {
                                    this.agentStatuses[agent.agent_id] = 'error';
                                }
                                
                            } catch (error) {
                                this.agentStatuses[agent.agent_id] = 'error';
                            }
                            
                            // Brief pause between tests
                            await new Promise(resolve => setTimeout(resolve, 200));
                        }
                        
                        const endTime = Date.now();
                        const duration = endTime - startTime;
                        
                        // Update performance stats
                        this.performanceStats.totalTests = this.agents.length;
                        this.performanceStats.successRate = Math.round((successCount / this.agents.length) * 100);
                        this.performanceStats.avgResponseTime = Math.round(duration / this.agents.length);
                        
                        this.addMessage('system', `All agents tested: ${successCount}/${this.agents.length} successful (${duration}ms total)`);
                        
                    } catch (error) {
                        console.error('Test all agents error:', error);
                        this.addMessage('system', `Test all agents failed: ${error.message}`);
                    } finally {
                        this.testingInProgress = false;
                    }
                },
                
                async runWorkflow() {
                    if (!this.selectedWorkflow) return;
                    
                    this.workflowRunning = true;
                    this.workflowProgress = 0;
                    this.workflowResults = [];
                    
                    try {
                        const workflows = {
                            strategic_planning: {
                                participants: ['ali', 'amy', 'baccio'],
                                scenario: this.customScenario || 'Develop Q4 strategic plan and budget allocation'
                            },
                            problem_solving: {
                                participants: ['ava', 'behice', 'andrea', 'sofia'],
                                scenario: this.customScenario || 'Analyze and solve customer churn issue'
                            },
                            technical_design: {
                                participants: ['baccio', 'dan', 'marco', 'luca'],
                                scenario: this.customScenario || 'Design scalable microservices architecture'
                            },
                            creative_collaboration: {
                                participants: ['jony', 'sara', 'sofia', 'riccardo'],
                                scenario: this.customScenario || 'Create brand campaign for AI features'
                            },
                            crisis_management: {
                                participants: ['thor', 'luca', 'dan', 'ali'],
                                scenario: this.customScenario || 'Handle critical security vulnerability'
                            }
                        };
                        
                        const workflow = workflows[this.selectedWorkflow];
                        const steps = workflow.participants.length;
                        
                        for (let i = 0; i < steps; i++) {
                            const agent = workflow.participants[i];
                            this.workflowProgress = ((i + 1) / steps) * 100;
                            
                            this.addWorkflowResult('info', agent, `Processing step ${i + 1}/${steps}`);
                            
                            try {
                                const response = await fetch(`${this.apiBase}/api/v1/agents/conversation`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        message: `${workflow.scenario}. This is step ${i + 1} of ${steps} in our workflow.`,
                                        agent: agent,
                                        session_id: this.sessionId + '_workflow_' + this.selectedWorkflow,
                                        context: {
                                            workflow: this.selectedWorkflow,
                                            step: i + 1,
                                            total_steps: steps,
                                            participants: workflow.participants
                                        }
                                    })
                                });
                                
                                if (response.ok) {
                                    const data = await response.json();
                                    this.addWorkflowResult('success', agent, data.response || data.content);
                                } else {
                                    this.addWorkflowResult('error', agent, 'Failed to respond');
                                }
                                
                            } catch (error) {
                                this.addWorkflowResult('error', agent, `Error: ${error.message}`);
                            }
                            
                            // Pause between steps
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                        
                        this.addWorkflowResult('success', 'system', 'Workflow completed successfully');
                        
                    } catch (error) {
                        console.error('Workflow error:', error);
                        this.addWorkflowResult('error', 'system', `Workflow failed: ${error.message}`);
                    } finally {
                        this.workflowRunning = false;
                        this.workflowProgress = 100;
                    }
                },
                
                stopWorkflow() {
                    this.workflowRunning = false;
                    this.addWorkflowResult('warning', 'system', 'Workflow stopped by user');
                },
                
                async runLoadTest() {
                    this.loadTestRunning = true;
                    
                    try {
                        const startTime = Date.now();
                        const promises = [];
                        
                        for (let i = 0; i < this.loadTest.requests; i++) {
                            const promise = fetch(`${this.apiBase}/api/v1/agents/conversation`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    message: `Load test message ${i + 1}`,
                                    agent: 'ali',
                                    session_id: this.sessionId + '_load_' + i,
                                    context: { load_test: true }
                                })
                            });
                            
                            promises.push(promise);
                            
                            // Limit concurrent requests
                            if (promises.length >= this.loadTest.concurrent) {
                                await Promise.allSettled(promises.splice(0, this.loadTest.concurrent));
                            }
                        }
                        
                        // Wait for remaining requests
                        if (promises.length > 0) {
                            await Promise.allSettled(promises);
                        }
                        
                        const endTime = Date.now();
                        const duration = endTime - startTime;
                        
                        this.addMessage('system', `Load test completed: ${this.loadTest.requests} requests in ${duration}ms`);
                        
                    } catch (error) {
                        console.error('Load test error:', error);
                        this.addMessage('system', `Load test failed: ${error.message}`);
                    } finally {
                        this.loadTestRunning = false;
                    }
                },
                
                async runStressTest() {
                    this.stressTestRunning = true;
                    
                    try {
                        // Stress test with high concurrency
                        const requests = 200;
                        const concurrency = 20;
                        const startTime = Date.now();
                        
                        const batches = Math.ceil(requests / concurrency);
                        
                        for (let batch = 0; batch < batches; batch++) {
                            const batchPromises = [];
                            
                            for (let i = 0; i < concurrency && (batch * concurrency + i) < requests; i++) {
                                const requestId = batch * concurrency + i;
                                
                                const promise = fetch(`${this.apiBase}/api/v1/agents/conversation`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        message: `Stress test message ${requestId + 1}`,
                                        agent: 'ali',
                                        session_id: this.sessionId + '_stress_' + requestId,
                                        context: { stress_test: true }
                                    })
                                });
                                
                                batchPromises.push(promise);
                            }
                            
                            await Promise.allSettled(batchPromises);
                        }
                        
                        const endTime = Date.now();
                        const duration = endTime - startTime;
                        
                        this.addMessage('system', `Stress test completed: ${requests} requests in ${duration}ms`);
                        
                    } catch (error) {
                        console.error('Stress test error:', error);
                        this.addMessage('system', `Stress test failed: ${error.message}`);
                    } finally {
                        this.stressTestRunning = false;
                    }
                },
                
                generateReport() {
                    this.reportData = {
                        testSuite: 'Convergio E2E Test Suite',
                        executionTime: '15:23 minutes',
                        successRate: this.performanceStats.successRate,
                        issuesCount: Math.floor(Math.random() * 5),
                        detailedResults: [
                            {
                                id: 1,
                                testName: 'Agent Initialization',
                                description: 'All 48 agents successfully initialized',
                                duration: 2340,
                                status: 'success'
                            },
                            {
                                id: 2,
                                testName: 'Multi-Agent Workflows',
                                description: 'Sequential and parallel workflows executed',
                                duration: 8750,
                                status: 'success'
                            },
                            {
                                id: 3,
                                testName: 'Ali Proactive Intelligence',
                                description: 'Proactive insights and recommendations tested',
                                duration: 4320,
                                status: 'warning'
                            },
                            {
                                id: 4,
                                testName: 'Cost Tracking',
                                description: 'Cost limits and tracking accuracy verified',
                                duration: 1850,
                                status: 'success'
                            },
                            {
                                id: 5,
                                testName: 'Security Validation',
                                description: 'Security framework and threat detection',
                                duration: 3200,
                                status: 'error'
                            }
                        ]
                    };
                },
                
                exportResults() {
                    const results = {
                        timestamp: new Date().toISOString(),
                        agents: this.agents,
                        conversation: this.conversation,
                        workflowResults: this.workflowResults,
                        performanceStats: this.performanceStats,
                        reportData: this.reportData
                    };
                    
                    const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `convergio-test-results-${Date.now()}.json`;
                    a.click();
                    
                    URL.revokeObjectURL(url);
                },
                
                downloadLogs() {
                    const logs = this.conversation.map(msg => 
                        `[${msg.timestamp}] ${msg.type.toUpperCase()}: ${msg.content}`
                    ).join('\n');
                    
                    const blob = new Blob([logs], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `convergio-test-logs-${Date.now()}.txt`;
                    a.click();
                    
                    URL.revokeObjectURL(url);
                },
                
                addMessage(type, content, agent = null) {
                    this.conversation.push({
                        id: Date.now() + Math.random(),
                        type: type,
                        content: content,
                        agent: agent,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // Auto-scroll to bottom
                    this.$nextTick(() => {
                        const conversationArea = document.querySelector('.conversation-area');
                        if (conversationArea) {
                            conversationArea.scrollTop = conversationArea.scrollHeight;
                        }
                    });
                },
                
                addWorkflowResult(type, agent, message) {
                    this.workflowResults.push({
                        id: Date.now() + Math.random(),
                        type: type,
                        agent: agent,
                        message: message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                },
                
                clearConversation() {
                    this.conversation = [];
                },
                
                getAgentStatus(agentId) {
                    return this.agentStatuses[agentId] || 'ready';
                },
                
                updatePerformanceStats() {
                    // Simulate real-time updates
                    setInterval(() => {
                        if (Math.random() > 0.8) {
                            this.performanceStats.totalTests += Math.floor(Math.random() * 3);
                            this.performanceStats.avgResponseTime = 200 + Math.floor(Math.random() * 300);
                        }
                    }, 5000);
                },
                
                initializeCharts() {
                    this.$nextTick(() => {
                        // Response Time Chart
                        const ctx1 = document.getElementById('responseTimeChart');
                        if (ctx1) {
                            new Chart(ctx1, {
                                type: 'line',
                                data: {
                                    labels: ['10:00', '10:05', '10:10', '10:15', '10:20', '10:25'],
                                    datasets: [{
                                        label: 'Response Time (ms)',
                                        data: [200, 250, 180, 220, 190, 240],
                                        borderColor: '#667eea',
                                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                        tension: 0.4
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false
                                }
                            });
                        }
                        
                        // Agent Performance Chart
                        const ctx2 = document.getElementById('agentPerformanceChart');
                        if (ctx2) {
                            new Chart(ctx2, {
                                type: 'bar',
                                data: {
                                    labels: ['Ali', 'Amy', 'Baccio', 'Dan', 'Sara', 'Sofia'],
                                    datasets: [{
                                        label: 'Success Rate (%)',
                                        data: [95, 92, 88, 96, 89, 91],
                                        backgroundColor: [
                                            '#667eea',
                                            '#764ba2',
                                            '#f093fb',
                                            '#f5576c',
                                            '#4facfe',
                                            '#00f2fe'
                                        ]
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            max: 100
                                        }
                                    }
                                }
                            });
                        }
                    });
                }
            }
        }).mount('#app');
    </script>
</body>
</html>